"undefined"==typeof window.Mozilla&&(window.Mozilla={}),function(){"use strict";var c={COOKIE_CODE_ID:"moz-stub-attribution-code",COOKIE_SIGNATURE_ID:"moz-stub-attribution-sig"};c.experimentName,c.experimentVariation,c.successCallback,c.timeoutCallback,c.requestComplete=!1,c.withinAttributionRate=function(){return Math.random()<c.getAttributionRate()},c.getAttributionRate=function(){var t=document.getElementsByTagName("html")[0].getAttribute("data-stub-attribution-rate");return isNaN(t)||!t?0:Math.min(Math.max(parseFloat(t),0),1)},c.hasCookie=function(){return Mozilla.Cookies.hasItem(c.COOKIE_CODE_ID)&&Mozilla.Cookies.hasItem(c.COOKIE_SIGNATURE_ID)},c.setCookie=function(t){if(t.attribution_code&&t.attribution_sig){var e=new Date;e.setTime(e.getTime()+864e5);var i=e.toUTCString();Mozilla.Cookies.setItem(c.COOKIE_CODE_ID,t.attribution_code,i,"/"),Mozilla.Cookies.setItem(c.COOKIE_SIGNATURE_ID,t.attribution_sig,i,"/")}},c.getCookie=function(){return{attribution_code:Mozilla.Cookies.getItem(c.COOKIE_CODE_ID),attribution_sig:Mozilla.Cookies.getItem(c.COOKIE_SIGNATURE_ID)}},c.updateBouncerLinks=function(t){if(t.attribution_code&&t.attribution_sig&&c.meetsRequirements())for(var e=document.querySelectorAll(".download-list .download-link, .c-button-download-thanks .download-link, .download-platform-list .download-link"),i=0;i<e.length;i++){var o,n,a=e[i];a.href&&-1!==a.href.indexOf("https://download.mozilla.org")?(o=a.getAttribute("data-download-version"))&&/win/.test(o)&&(a.href=Mozilla.StubAttribution.appendToDownloadURL(a.href,t)):a.href&&-1!==a.href.indexOf("/firefox/download/thanks/")&&(n=a.getAttribute("data-direct-link"))&&a.setAttribute("data-direct-link",Mozilla.StubAttribution.appendToDownloadURL(n,t))}},c.appendToDownloadURL=function(t,e){if(!e.attribution_code||!e.attribution_sig)return t;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&("attribution_code"!==i&&"attribution_sig"!==i||(t+=(-1<t.indexOf("?")?"&":"?")+i+"="+e[i]));return t},c.onRequestSuccess=function(t){t.attribution_code&&t.attribution_sig&&!c.requestComplete&&(c.updateBouncerLinks(t),c.setCookie(t),c.requestComplete=!0,"function"==typeof c.successCallback&&c.successCallback())},c.onRequestTimeout=function(){c.requestComplete||(c.requestComplete=!0,"function"==typeof c.timeoutCallback&&c.timeoutCallback())},c.requestAuthentication=function(t){var e=window.location.protocol+"//"+window.location.host+"/en-US/firefox/stub_attribution_code/",o=new window.XMLHttpRequest,n=setTimeout(c.onRequestTimeout,1e4);o.open("GET",e+"?"+window._SearchParams.objectToQueryString(t)),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.onreadystatechange=function(){if(4===o.readyState){var t=o.status;if(t&&200<=t&&t<400)try{var e=JSON.parse(o.responseText);clearTimeout(n),c.onRequestSuccess(e)}catch(i){c.onRequestTimeout()}}},o.timeout=1e4,o.send()},c.getUserAgent=function(t){return t=void 0!==t?t:navigator.userAgent,/MSIE|Trident/i.test(t)?"ie":/Edg|Edge/i.test(t)?"edge":/Firefox/.test(t)?"firefox":/Chrome/.test(t)?"chrome":"other"},c.getGAVisitID=function(){try{return window.ga.getAll()[0].get("clientId")}catch(t){return null}},c.waitForGoogleAnalytics=function(e){var i,o=0,n=100,a=20;!function r(){clearTimeout(i);var t=c.getGAVisitID();t&&"string"==typeof t?e(!0):o<=a?(o+=1,i=window.setTimeout(r,n)):e(!1)}()},c.getAttributionData=function(t){var e=new window._SearchParams,i=e.utmParams(),o=e.get("experiment")||c.experimentName,n=e.get("variation")||c.experimentVariation,a=void 0!==t?t:document.referrer,r=c.getUserAgent(),u=c.getGAVisitID(),s={utm_source:i.utm_source,utm_medium:i.utm_medium,utm_campaign:i.utm_campaign,utm_content:i.utm_content,referrer:a,ua:r,experiment:o,variation:n,visit_id:u};for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&("undefined"!=typeof s[l]&&null!==s[l]||delete s[l]);return s},c.hasValidData=function(t){return"string"!=typeof t.utm_content||"string"!=typeof t.referrer||!/^rta:/.test(decodeURIComponent(t.utm_content))||-1!==t.referrer.indexOf("https://addons.mozilla.org")},c.isFirefoxNewScene2=function(t){return-1<(t=void 0!==t?t:window.location.href).indexOf("/firefox/download/thanks/")},c.meetsRequirements=function(){return"undefined"!=typeof window.site&&"undefined"!=typeof Mozilla.Cookies&&"undefined"!=typeof window._SearchParams&&(!!Mozilla.Cookies.enabled()&&("windows"===window.site.platform&&!Mozilla.dntEnabled()))},c.init=function(t,e){var i={};c.meetsRequirements()&&("function"==typeof t&&(c.successCallback=t),"function"==typeof e&&(c.timeoutCallback=e),c.hasCookie()?(i=c.getCookie(),c.updateBouncerLinks(i)):c.isFirefoxNewScene2()||c.waitForGoogleAnalytics(function(){(i=c.getAttributionData())&&c.withinAttributionRate()&&c.hasValidData(i)&&c.requestAuthentication(i)}))},window.Mozilla.StubAttribution=c}(),function(){"use strict";Mozilla.StubAttribution.init()}();